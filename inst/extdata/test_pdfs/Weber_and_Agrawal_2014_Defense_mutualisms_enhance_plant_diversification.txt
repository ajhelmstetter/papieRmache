Defense mutualisms enhance plant diversification
Marjorie G. Weber1,2 and Anurag A. Agrawal
Department of Ecology and Evolutionary Biology, Cornell University, Ithaca, NY 14853
Edited by Sarah P. Otto, University of British Columbia, Vancouver, Canada, and approved September 22, 2014 (received for review July 14, 2014)

The ability of plants to form mutualistic relationships with animal
defenders has long been suspected to influence their evolutionary
success, both by decreasing extinction risk and by increasing
opportunity for speciation through an expanded realized niche.
Nonetheless, the hypothesis that defense mutualisms consistently
enhance plant diversification across lineages has not been well
tested due to a lack of phenotypic and phylogenetic information.
Using a global analysis, we show that the >100 vascular plant
families in which species have evolved extrafloral nectaries (EFNs),
sugar-secreting organs that recruit arthropod mutualists, have
twofold higher diversification rates than families that lack species
with EFNs. Zooming in on six distantly related plant clades, traitdependent diversification models confirmed the tendency for lineages with EFNs to display increased rates of diversification. These
results were consistent across methodological approaches. Inference using reversible-jump Markov chain Monte Carlo (MCMC) to
model the placement and number of rate shifts revealed that high
net diversification rates in EFN clades were driven by an increased
number of positive rate shifts following EFN evolution compared
with sister clades, suggesting that EFNs may be indirect facilitators
of diversification. Our replicated analysis indicates that defense
mutualisms put lineages on a path toward increased diversification
rates within and between clades, and is concordant with the hypothesis that mutualistic interactions with animals can have an impact on
deep macroevolutionary patterns and enhance plant diversity.

|

|

mutualism extrafloral nectaries plant–insect interactions
lineage diversification rates plant defense

|

|

Downloaded by guest on March 2, 2020

E

ver since the key innovation hypothesis was first proposed in
the 1940s (1, 2), the origination of novel traits has been a
popular yet controversial explanation for the exceptional disparity in species richness observed across clades in the tree of
life. Despite decades of research linking traits to diversification,
we have remarkably few examples of traits that have been convincingly demonstrated to spur diversification repeatedly across
independent, distantly related groups. Notable exceptions include
a number of ecologically important traits mediating interactions
between plants and animals (3–6), suggesting that these interactions may be particularly important drivers of macroevolutionary patterns. Here, we test the hypothesis that plant defense
mutualisms, a widespread and classically studied ecological interaction whereby plants provide food rewards to arthropod
bodyguards in return for protection against natural enemies (7),
increase the evolutionary diversification rate of the plant lineages
that participate in them. The morphological traits that mediate
defense mutualisms represent well-studied examples of characters
hypothesized to expand a plant’s niche via interactions with
mutualists and influence species success in various environmental
contexts (8). Although the costs and benefits of participating in
defense mutualisms are well studied (9), the hypothesis that the
ecological impact of defense mutualisms leaves a predictable
macroevolutionary signature, increasing lineage diversification
within and among clades of plants, has only been examined in a
single genus (10).
Defense mutualisms may have an impact on plant speciation
and extinction rates via several mechanisms. Unlike the evolution of traits related to reproduction, which, more intuitively,
could have an impact on lineage diversification (e.g., refs. 5, 11),

16442–16447 | PNAS | November 18, 2014 | vol. 111 | no. 46

the direct mechanism by which defense mutualisms are hypothesized to influence diversification is less obvious. One direct
mechanism is a decreased incidence of damage and disease due to
an enhanced defensive repertoire, which may allow for increased
population sizes and, in turn, lower extinction rates (6). Additionally, by expanding the realized niche of a plant (12), defense
mutualisms may broaden the range of habitats a plant can occupy
(10), thereby increasing instances of allopatric speciation.
However, in addition to these direct mechanisms, the evolution of mutualistic traits may facilitate diversification indirectly.
First, if niche expansion results in the successful occupation of
more environments, mutualistic traits may increase the probability a lineage will encounter conditions ripe with ecological
opportunity (e.g., new adaptive zones), which, in turn, will drive
increases in diversification. In other words, the evolution of a
trait may enable subsequent diversification via increasing exposure to new environments, some of which will harbor external
drivers of radiation, such as the uplift of a mountain range or
unoccupied niches. Second, the evolution of defense mutualisms
may free up resources for the plant, and thereby facilitate the
evolution of other innovative traits that subsequently enhance
diversification. These indirect effects need not be contingent on
the existence of the direct effects mentioned above, and represent a largely overlooked hypothesis concerning how traits can
affect diversification (13–15).
We suggest that indirect impacts of trait evolution on diversification should be reflected in a phylogenetic pattern in
which the origination of a trait is followed by an increased
probability of subsequent, downstream rate shifts relative to
clades that lack the trait (Fig. 1). Because the indirect effect of
Significance
Plants that provide food and housing to animals in return for
defense against enemies are classic examples of mutualistic
partnerships in nature. Here, we show that the evolution of
such plant–animal mutualisms also can lead to a trajectory of
accelerated accumulation of plant species in the lineages that
participate in these cooperative interactions. We found that
the evolution of plant organs (extrafloral nectaries) that facilitate mutualisms with animal defenders was repeatedly followed by increased rates of diversification across distantly
related plant lineages. These results suggest that by enabling
ecological interactions with animals, the convergent evolution
of relatively simple glands changed the course of plant evolution toward greater protection from pests and accelerated the
generation of biodiversity.
Author contributions: M.G.W. and A.A.A. designed research; M.G.W. performed research;
M.G.W. analyzed data; and M.G.W. and A.A.A. wrote the paper.
The authors declare no conflict of interest.
This article is a PNAS Direct Submission.
Data deposition: The phylogenies, character matrices, GenBank accession numbers, and
R scripts reported in this paper have been deposited in DataDryad, dx.doi.org/10.5061/
dryad.17fj8.
1

Present address: Center for Population Biology, University of California, Davis, CA 95616.

2

To whom correspondence should be addressed. Email: mgweber@ucdavis.edu.

This article contains supporting information online at www.pnas.org/lookup/suppl/doi:10.
1073/pnas.1413253111/-/DCSupplemental.

www.pnas.org/cgi/doi/10.1073/pnas.1413253111

Indirect Effect

EFNs
originate

EFNs
originate

Direct + Indirect Effects

EFNs
originate

= Rate shift
= Rate 1
= Rate 2
= Rate 3

Fig. 1. A conceptualization of phylogenetic patterns consistent with direct
or indirect effects of EFNs (or any trait) on lineage diversification. A net
change in diversification may be due to direct or indirect mechanisms. In the
Upper Right, a rate shift occurs concomitantly with the origin of EFNs,
consistent with a direct effect. If one or more shifts occur with some delay
(Lower), this is consistent with a hypothesis that a trait has an indirect or
context-dependent effect on diversification rates.

Downloaded by guest on March 2, 2020

the trait is contingent upon additional conditions (e.g., ecological opportunity, the evolution of another trait), there may be
a substantial lag between the origin of the trait and rate shifts.
Alternatively, a direct effect of the trait on the diversification rate
is consistent with a pattern whereby a sustained rate shift occurs
concomitantly with, or on the same branch as, the origin of the
trait on the phylogeny (Fig. 1). Direct and indirect patterns are
not mutually exclusive, and both patterns may be detectable on
a single phylogeny (Fig. 1).
We focus on the macroevolutionary consequences of the repeated origination of extrafloral nectaries (EFNs), nectar-secreting glands found on nonfloral plant tissues that provide food for
a wide array of beneficial arthropod bodyguards (16). EFNs are
well studied ecologically, and their only known function is defense
against herbivores and microbial pathogens by attracting natural
enemies (17). Such features have evolved hundreds of times and
occur in about a quarter of all vascular plant families (18). Here,
we first ask whether, across all vascular plants, families containing
species with EFNs are associated with higher diversification rates
than families without EFNs. We then focus in on the phylogenetic
history and evolution of EFNs in six distantly related plant clades
to evaluate whether EFNs are linked, directly or indirectly, to
increased lineage diversification rates. As such, this study
represents a replicated, multiscale test of the macroevolutionary consequences of a convergently evolved and ecologically
important mutualistic trait.
Results and Discussion
In a global analysis of vascular plant families, we combined
published records of EFN occurrence (18) with fossil calibrated
megatrees (19–21) to compare net diversification rates across
families with and without species with EFNs. Overall, net diversification rates were more than twofold higher among the 108
Weber and Agrawal

families that contain instances of species with EFN compared
with the ∼300 families without species with EFNs (Fig. 2 and
Tables S1 and S2). Because our current knowledge likely
underestimates the number of families with EFNs by ∼7% (18),
we repeated this analysis with randomized inclusion of EFNs in
otherwise non-EFN families and found the initial result to be
robust to missing information (Fig. S1). Additionally, we found
no evidence that EFN-bearing clades were older than non-EFN
clades, suggesting they did not have more time to accumulate
their greater number of species than clades without EFNs (Fig.
S1). Finally, phylogenetic nonindependence did not confound
estimates of the relationship between EFNs and species richness,
because the evolution of EFNs was significantly unstructured
compared with the null expectation of Brownian motion evolution [angiosperm phylogeny group megatree (APGIII): D = 0.75,
P < 0.001; Zanne et al. megatree (21): D = 0.64, P = 0.006].
Results from our global analysis are consistent with a pattern
in which there is a net positive effect of this mutualistic trait on
rates of species diversification across the hundreds of independent
origins of EFNs. Nonetheless, these results should be interpreted
with caution due to the scale of the analysis. In particular, at this
broad level, it is not possible to link shifts in diversification directly
with the origin and loss of EFNs. Additionally, cases of EFNs may
be more likely to be reported in speciose families simply because
of their relatively large size, creating a sampling effect.
To address the limitations of the global analysis and to test for
direct vs. indirect evolutionary consequences of EFN evolution,
we pursued analyses at a finer taxonomic scale by reconstructing
the evolution of EFNs in six distantly related plant clades
(yellow stars in Fig. 2): Byttneria (Malvales), Senna (Fabales),
Turnera (Malpighaiales), Viburnum (Dipsacales), Polygoneae
(Caryophyllales), and Pleopeltis (Polypodiales). We selected these

EVOLUTION

EFNs
originate

Direct Effect

Diversification Rate
0.00 0.10 0.20 0.30

No Effect

EFNs
Absent

EFNs
Present

Fig. 2. Phylogeny of vascular plant families (APGIII) (19), with families containing species with EFNs colored red. Outer bars correspond to the agestandardized number of species [i.e., (log number of species)/(age of plant
family in millions of years)]. Yellow stars mark the families of the six clades
analyzed subsequently in this study. (Inset) Mean diversification rate (r) ± SE
of families with and without species with EFNs calculated according to the
method of Magallon and Sanderson (41) assuming no extinction. See Tables
S1 and S2 for F and P statistics and calculations with additional extinction
fractions for both megatrees.

PNAS | November 18, 2014 | vol. 111 | no. 46 | 16443

0.04

0.04
400

0.02

0

***
0

50

100

150

20

0.00

50 100

200

−50

−40

0

20

50

r1- r0

60

150

−100

net diversification rate

net diversification rate

60

0

**

0.004

100

40

40

80

0.008

0.04
0.02

0.010

−100 0

0

r1- r0

Viburnum

**
r1- r0

0.000

Density

*

0

0

Turnera

Senna

−50

−40

0.02

r1- r0

0.00

100 200 300 400

50 100 150

0.000

0

0

r1- r0

0.00

−400

0.003

Density

0.000

Polygoneae
0.06

Pleopeltis

0.006

Byttneria

100

300

200

500

net diversification rate

clades because they have recently published phylogenies, are
known to contain species with and without EFNs (10, 18, 22–27),
and are distantly related to one another. For Senna, which was
previously investigated for a link between EFN and diversification
rates (10), we added recently published records on EFNs in an
additional clade (28). Together, these six plant groups encompass
over 350 My of evolution since diverging from a common ancestor,
contain a wide variety of growth forms and life-history strategies,
and occupy diverse habitats across the globe.
For each lineage, we first investigated whether a macroevolutionary model invoking state-dependent diversification rates
[binary state speciation and extinction model (BiSSE)] (29, 30)
explained the phylogenetic distribution of EFNs and diversification patterns. We found that EFNs were associated with
higher mean net diversification rates (speciation rate − extinction rate) compared with lineages lacking EFNs in all six plant
groups (Fig. 3). We assessed statistical significance according to
the percentile of observed zero differences in state-dependent
net diversification rates according to the post–burn-in Markov
chain Monte Carlo (MCMC) interval. Differences in rates were
below the 0.05 (one-tailed) percentile for Pleopeltis (P < 0.001),
Turnera (P = 0.049), and Viburnum (P = 0.008); below 0.1 for
Senna (P = 0.06); and nonsignificant for Polygoneae (P = 0.13)
and Byttneria (P = 0.43) (Fig. 3, Inset). Combining the probabilities from the individual clades indicated that there was
a significant overall positive association between EFNs and diversification rate (Z = 4.087, P < 0.001).
In simulations using the observed trees and inferred transition
rates, but where EFNs evolved independently from rate shifts,
we found BiSSE type 1 error rates ranging from 3 to 34% for

600

r1- r0

Fig. 3. Marginal distribution of net diversification
rate (speciation − extinction) parameters in EFNpresent (red) and EFN-absent (black) clades from an
analysis using the Bayesian implementation of BiSSE
(29, 30) on MCC trees with median node heights from
BEAST analyses for each lineage. *P < 0.1; **P < 0.05;
***P < 0.001. (Insets) Histograms represent the joint
marginal distribution of the difference between EFN
and non-EFN diversification rates, with the >0.05%
probability quantile shaded dark gray and a dotted
line at zero.

individual topologies (Fig. S2). However, down-weighting the
observed P values by the probability of seeing observed results
in simulations still resulted in an overall combined probability
of less than 0.001 (Z = 4.045). We also confirmed the results
obtained from BiSSE using an alternative methodological approach that paired marginal ancestral state reconstructions of
EFNs (31) with a recently developed reversible jump Bayesian
framework for modeling diversification rates [Bayesian analysis
of macroevolutionary mixtures (BAMM)] (32). Here too, we
found that EFN portions of the phylogenies had higher mean net
diversification rates than non-EFN portions of the phylogeny in
the same four of six lineages examined (Table 1). Overall, the
broad pattern across clades is consistent with hypothesis that
EFNs play a role in increased plant diversification.
To test whether the increased rates of diversification associated with EFNs were consistent with direct or indirect effects on
diversification, we used the BAMM framework (32) to model the
number and placement of rate shifts on each phylogeny with
respect to the marginal probability of EFN presence or absence.
We found that rate shifts across our six clades were rarely placed
with high confidence on the same branch as EFN transition
events. Instead, the shifts that were responsible for the increased
net diversification rate in EFN clades were commonly estimated
to occur with some delay after the inferred origins of the trait
(Fig. 4). Additionally, results were divided with respect to the
hypothesis that defense mutualisms are favored by natural selection, and thus should be infrequently lost. In BiSSE analyses,
rates of EFN gain were estimated as higher than rates of loss in
three of the six clades (Table S3), whereas maximum likelihood

Table 1. Diversification estimates obtained for EFN and non-EFN clades from BAMM analyses
Whole trees
Plant group

Downloaded by guest on March 2, 2020

Byttneria
Pleopeltis
Polygoneae
Senna
Turnera
Viburnum

rEFN
172.25
65.11
23.66
113.54
24.23
266.6

rnonEFN

(53.3)
212.40 (105.24)
(29.56)
31.5 (9.88)
(7.26)
33.41 (6.83)
(27.24)
50.70 (28.15)
(6.42)
18.22 (7.22)
(67.92)
114.4 (43.86)

Sister clades
Shifts/cladeEFN Shifts/cladenonEFN
—
3.5 (2.45)
2.5 (1.87)
4.6 (3.2)
—
5 (3.32)

—
3 (2.16)
5.5 (3.02)
1 (1)
—
2.5 (1.87)

rEFN

rnonEFN

—
—
65.11 (21.18)
46.19 (18.59)
23.66 (7.26)
39.38 (7.73)
113.54 (27.24)
67.27 (39.34)
—
—
266.6 (67.92) 184.42 (79.34)

Shift/total timeEFN Shift/total timenonEFN
—
1.8 (0.93)
2.08 (1.0)
7.02 (2.93)
—
20.02 (7.35)

—
2.63 (1.36)
1.31 (0.41)
30.78 (10.28)
—
30.81 (12.79)

The mean (and SD) are reported. Sister clade comparisons were not possible for Byttneria and Turnera because of tree shape. Boldfaced numbers represent
the larger of the estimates of EFN to non-EFN for each metric. EFN, EFN present; nonEFN, EFN absent; r, whole-tree net diversification rate (speciation rate −
extinction rate), shifts/clade, number of rate shifts within the targeted sister clade, shift/time, number of rate shifts per total summed branch length in that
targeted sister clade.

16444 | www.pnas.org/cgi/doi/10.1073/pnas.1413253111

Weber and Agrawal

>10
5
0

Byttneria

Pleopeltis

Polygoneae
S1

Probability
0.2
0.4
0.0
0

2
4
6
Number of shifts

2
4
6
8
Number of shifts

Turnera

10

Viburnum

S0

Probability

0.0 0.2 0.4 0.6

0.0
Downloaded by guest on March 2, 2020

2
4
6
8
Number of shifts

S1

Probability
0.4
0.8

S0

S1

0

0

(ML) estimates supported five of the six clades as having higher
rates of EFN gain than loss (Table S4).
In four groups, tree shape and the distribution of EFNs
allowed for an additional comparison of the number of rate shifts
that occurred in sister clades with and without EFNs. This approach allowed us to ask whether EFN clades contain more rate
shifts than their non-EFN sisters while controlling for clade age.
Indeed, we found that in three of the four plant groups examined, rate shifts were estimated to have occurred more frequently
in EFN compared with non-EFN sister clades (Fig. 4 and Table
1). These same three groups displayed significant associations
between EFNs and diversification rates in analyses with BiSSE.
Sister clade comparisons of net diversification rates in the four
groups mirror these results and reveal the directionality of the
shifts: In three groups (Pleopeltis, Viburnum, and Senna), sister
clades with EFNs had higher net diversification rates than sister
clades without EFNs (Table 1). Because lineages with EFNs
have greater total branch length, there is the potential for these
lineages to have more shifts than lineages lacking EFNs without
EFNs increasing shift density (number of shifts/total branch
length) per se. Indeed, the density of rate shifts is not higher in
EFN clades (Table 1). Accordingly, EFNs may be initiating a
positive feedback, whereby slightly increased rates of diversification enhance the number of future rate shifts without affecting
shift density. Regardless of the mechanism, EFNs are frequently
associated with higher plant diversification.
Our results within and between clades suggest that EFNs, which
are ecologically important, common, and functionally convergent
traits across vascular plants, repeatedly set plant lineages on a path
toward higher rates of lineage diversification. At fine phylogenetic
scales, EFNs were generally associated with a higher incidence of
positive, but delayed, diversification rate shifts. This result suggests
that the means by which EFNs facilitate diversification may be
contingent on other factors (14), such as developmental differences
in EFN types, the presence or absence of other morphological
traits, or the environmental conditions in which they occur. EFNs
on their own may not be causally linked with immediate increased
ecological opportunity; rather, they may serve as indirect innovations, facilitating subsequent diversification rate shifts. However,
despite the fine-scale variation seen among the six clades studied
Weber and Agrawal

2

4

6

8

Number of shifts

10

Fig. 4. Diversification rate shifts in the EFN and
non-EFN clades of six plant clades. For each group,
the MCC tree is shown with branches that subtend
nodes with a high marginal probability of EFNs in
red and branches that subtend nodes with a high
marginal probability of non-EFN in black. Branch
widths are scaled to Bayes factors, representing
confidence that a rate shift occurred on that
branch. Bars to the right of phylogenies display the
EFN (S1) and non-EFN (S0) sister clades used in sisterclade comparisons. (Insets) Histograms display the
posterior distribution of the number of rate shifts in
the EFN clade (red) and the sister non-EFN clade
(gray).

here, we found a consistent pattern of EFNs associated with
families with higher diversification across all vascular plants.
Thus, although the ecological impacts of EFNs are variable in
space and time (33), macroevolutionary patterns of EFNs are
consistent across phylogenetic scales.
Other traits hypothesized to increase diversification rates have
also shown a delayed association with rate shifts [e.g., C4 photosynthesis (34), mammary glands (35), complete metamorphism
(36)], suggesting that this pattern may be widespread. However,
testing causal hypotheses that link a trait with a delayed set of
rate shifts can be challenging due to the possibility of interceding
traits and evolutionary transitions in the same area of the phylogeny. This issue is one reason why evolutionary replication is
key, because it increases our confidence that a particular trait
may or may not be playing a role, allowing us to disentangle the
complex ways in which traits interact with each other and the
environment to influence diversification. For EFNs, our work
within and between clades suggests that over deep time, these
important defensive traits have enhanced diversification rates
and, ultimately, the diversity of plant species.
Methods
Vascular Plant Family Analysis. To test for a global association between defense
mutualism and plant diversification, we compared net diversification rates of
vascular plant families with and without species with EFNs. Families were scored
as either containing or not containing accounts of at least one species with EFNs
based on previous work (18). We used two published megatree phylogenies to
account for phylogenetic uncertainty. The first was the APGIII megatree from
the Angiosperm Phylogeny Group (19) acquired from Phylomatic (R20120829)
(37) using one representative tip per family. The APGIII tree is a compilation of
previously published plant phylogenies and gives the most up-to-date estimate
of relationships. We time-calibrated the APGIII phylogeny by adjusting branch
lengths according to fossil-based age estimates from Wikström et al. (20) using
parametric rate-smoothing estimates with the program Phylocom (38). The
second phylogeny was a rooted vascular plant megatree published by Zanne
et al. (21), which was calibrated according to divergence time estimates from
the broadly sampled molecular phylogeny of Soltis et al. (39) and 39 fossil
calibration points (21). For analyses, this tree was trimmed so that each family
was represented by only one tip using the drop.tip function in the R package
Analyses of Phylogenetics and Evolution (APE) (40), which preserves topology
and branch lengths. Genera were assigned to families according to the supplementary data in the study by Zanne et al. (21).

PNAS | November 18, 2014 | vol. 111 | no. 46 | 16445

EVOLUTION

Senna

S0

S1

Probability
0.0 0.2 0.4

S0

0

We calculated the net diversification rate using the method of Magallón
and Sanderson (41) implemented in GEIGER (42). We calculated rates based
on species richness and clade ages estimated as terminal branch lengths
from both the APGIII tree and the tree published by Zanne et al. (21). We
repeated calculations for four values of e, the extinction rate, expressed as
a fraction of the speciation rate: 0, 0.1, 0.5, and 0.9. The number of species in
each family was taken from Stevens (43). Because a range of species counts
for a family was reported in some cases, we repeated all analyses across
maximum and minimum species estimates. The difference in the mean net
diversification rate of families with and without EFNs was then analyzed by
a two-way ANOVA. Because our current knowledge likely underestimates
the number of families with EFNs by 4–9% (18), we repeated this analysis
10,000 times, each time converting 10 (an additional ∼9% of the current
total) randomly selected EFN-absent families to EFN-present families to
simulate conservatively the discovery of new families with EFNs.
We tested for phylogenetic signal in the presence of species with EFNs in
a family via the estimation of Fritz and Purvis’ D for binary traits, which is
a measure of sister-clade differences in a discrete character state for a given
phylogeny (44). An estimated D of 1 implies a distribution that is random
with respect to the phylogeny, whereas a D of 0 implies a distribution
expected under Brownian motion (44). Using the R package caper (45), we
calculated D for the presence of EFNs, and to assess significance, we compared our estimate with simulated distributions of D under (i) randomly
reshuffled trait values across the tips of the tree and (ii) trait evolution
under Brownian motion. Each simulation included 10,000 permutations. This
approach preserves the phylogenetic relationships of families, as well as the
number of families assigned to each character state, although it varies the
distribution of character states across the tree.
Clade-Level Analyses. We selected six vascular plant clades for phylogenetic
comparative analyses that (i) had sequence representation in GenBank and
(ii) were known to contain species with and without EFNs based
on descriptions in the literature: Byttneria (Malvaceae), Pleopeltis (Polypodiaceae), Polygoneae (Polygoneaceae), Senna (Fabaceae), Turnera (Passifloraceae), and Viburnum (Adoxaceae). Each of these clades represents an
independent evolutionary origin of EFNs, and, together, they span a large
portion of the angiosperm tree of life.

Downloaded by guest on March 2, 2020

Phylogenetic Inference. We reconstructed a distribution of time-calibrated
phylogenies separately for each genus using Bayesian methods to include the
highest possible number of species because the most recently published
phylogenies of our clades of interest were frequently not ultrametric. Sequence availability for each group was evaluated, and sequences were
obtained from the GenBank using the PhyLoTA Browser (release 1.5) (46).
Molecular markers were chosen for inclusion in phylogenetic analyses if they
were sampled for over 30% of the species available in the GenBank (accession numbers have been deposited in DataDryad; dx.doi.org/10.5061/
dryad.17fj8). Outgroup taxa were selected based on the most recent published phylogeny or from the parent cluster in PhyLoTA based on overlapping sequence coverage with in-group taxa. Nucleotide sequences were
aligned using the L-INS-I strategy in MAFFT (version 6) (47) with a gap
opening penalty of 1.53 and an offset value of 0.0 using the R (48) package
PHYLOCH (49). We trimmed aligned sequence ends to minimize missing data
among taxa and checked alignments by hand. We used jModelTest (50)
to determine appropriate substitution models for each partition based
on Akaike’s information criterion (Table S5) and estimated starting
parameters for Bayesian inference using the R package phanghorn (51).
For each of the six clades, we estimated the joint posterior distribution of
topologies and relative node divergence times using three independent
Bayesian MCMC searches in Bayesian Evolutionary Analysis Sampling Trees
(BEAST) (52). Each marker was partitioned with its own unlinked, previously
estimated substitution model. We used one uncorrelated exponential relaxed clock model to estimate node heights for all of the partitions. For each
clade, three MCMC searches were run for 1 million generations sampled
every 10,000 generations using a random starting tree. Trees were rooted by
constraining the in-group to be monophyletic. Convergence of each Bayesian run was assessed by plotting the log-likelihood of sampled trees and
parameters using Tracer (version 1.5) (53). The first 25% of sampled trees
were removed from each run as a burn-in. A maximum clade credibility
(MCC) tree was identified from the combined output of the three MCMC
runs using LogCombiner (54) and TreeAnnotator (55).
Character State Assignment. The presence or absence of EFNs was coded as
a discrete, binary character state. The distribution of EFNs within each clade
was evaluated using previous publication records (10, 18, 22–27) and herbarium

16446 | www.pnas.org/cgi/doi/10.1073/pnas.1413253111

specimens from the Bailey Hortorium of Cornell University, the herbaria of the
Yale Peabody Museum of Natural History, and digitized specimens in the
JSTOR Global Plants database (plants.jstor.org). The world list of plants with
EFNs database can be accessed at www.extrafloralnectaries.org (56).
Lineage Diversification Analyses. We evaluated whether net diversification
rates in each clade were dependent on EFN state using BiSSE (29) and BAMM
(32). Outgroup taxa and multiple individuals per species were pruned from
the MCC tree for each analysis so that resulting phylogenies contained only
one sample per species.
We used the BiSSE (29) state-dependent speciation and extinction model to
estimate net diversification (speciation − extinction) rates in lineages with and
without EFNs. We implemented the Bayesian MCMC BiSSE algorithm in the
diversitree package in R (31). Because some species are missing from our
phylogenies for each of our six groups, we accounted for missing taxa in these
analyses by including information on the proportions of taxa (included and
missing) assigned to each character state (30) using species descriptions and
clade estimates from previous publications (10, 23–26, 57). In cases where the
character state of missing species was unknown, we assumed the proportions
of character states in our known samples were representative (Table S6).
To test whether EFN and non-EFN lineages had different diversification
rates, we used Bayesian MCMC BiSSE analyses on the MCC tree for each clade.
We used exponential priors for all parameters estimated using the starting.
point.bisse function in diversitree, with a mean of twice the state-independent net diversification rate. Initial models were fit using parameter
starting points estimated from a constant-rate birth–death model. We assumed a Markov (Mk) model of evolution for the trait in all cases. First, a
primary MCMC was run for each clade for 1,000 generations with an arbitrary tuning parameter of 0.1. We used the posterior parameter distributions of these initial MCMC runs to estimate tuning parameters of the
final MCMC analyses, which each ran for 10,000 generations. Significance
was assessed according to the credible set of the differences between statedependent net diversification rates. Finally, to gain insight into the probability of seeing our results if EFNs were evolving independent of rate shift
location, we conducted ML-BiSSE analyses across the same topologies using
simulated trait data. EFN tip states were simulated as discrete characters 100
times for each topology using an Mk2 model with parameter estimates fit
using the observed trait data with the fitDiscrete function in the R package
GEIGER (41). Simulations with fewer than five species in each state were
rejected to condition on having more than a small number of species in one
state. Root states for simulations were determined using a random draw
from a binomial distribution with a probability of successfully drawing
a state proportional to the marginal probability of that state at the root in the
ancestral reconstruction using the asr.bisse function in diversitree (31). We
used a weighted Z-test (58) to combine probabilities from the six BiSSE analyses, both with and without weights equal to the inverse of the probability of
seeing our observed P value in simulations (to account for type 1 error rate).
To examine (i) whether lineages with EFNs contained more rate shifts
than lineages without EFNs, (ii) whether EFN lineages had a higher density
of rate shifts than non-EFN clades, and (iii) where rate shifts occurred on
phylogenies in relation to EFN origination or loss, we used BAMM (32) and
the package BAMMtools (59). For each clade, we performed three BAMM
runs on the MCC phylogeny from the log-combined BEAST analyses to avoid
getting stuck in local optima. Each BAMM analysis was run for 1 million
MCMC generations, sampling parameters every 50,000 generations. We
accounted for incomplete sampling in each clade according to diversity
estimates from publications (10, 23–26, 57). We ran Bayesian MEDUSA-like
models, where the rates of speciation and extinction were constant within
shift regimes by setting the updateRateLambdaShift and lambdaShift0
parameters to 0. We computed tree appropriate rate priors using the setBAMMpriors function in BAMMtools, and used a flattened PoissonRatePrior of
0.1 and a minimum clade size for rate shifts (minCladeSizeforShift) of 2. We
assessed convergence of the three BAMM runs for each clade by ensuring the
effective sample sizes of log-likelihoods, number of processes, and evolutionary rate parameters were greater than 500 using the CODA library (60).
We assigned the presence or absence of EFNs to clades according to the
probability of each state at internal nodes using the asr.marginal function in
diversitree (31), which performs marginal reconstructions of ancestral states
for each node. To account for potentially misleading effects of trait-associated
diversification rates, we reconstructed ancestral states of EFNs under the BiSSE
model, which was fit for each clade using the using the make.bisse and find.
mle functions, with starting parameter guesses of the mean parameter estimates from MCMC BiSSE analyses. We then asked whether portions of the tree
in the EFN state have a higher net diversification rate than branches in the
non-EFN state. Diversification rates were calculated using the getcladerate

Weber and Agrawal

Downloaded by guest on March 2, 2020

function in BAMMtools on BAMMobjects pruned to include only EFN or only
non-EFN taxa using the subtreeBAMM function. This approach results in some
internal branches being included in both EFN and non-EFN rate estimates;
however, this double inclusion is conservative with respect to the hypothesis.
We visualized the probability of rate shifts on branches of the tree by scaling
the edge widths of each plotted phylogeny according to the Bayes factor associated with that branch using the bayesFactorBranches function. This method
corrects for differences in branch length or biases introduced by the prior on the
number of diversification rates. We estimated the number of shifts in sister clades
with and without EFNs for groups that had sister groups with and without EFNs
that included at least two species each. We used the subtreeBAMM function to
extract sister clades from the original BAMM objects. The shift density for each
extracted sister subclade was calculated by dividing each sample from the
subclade’s posterior by the sum of branch lengths for that subclade.

Data Availability. Phylogenies, character states, GenBank accession numbers, and R scripts are deposited in DataDryad (dx.doi.org/10.5061/dryad.17fj8).

1. Miller AH (1949) Some ecologic and morphologic considerations in the evolution of
higher taxonomic categories. Ornithologie als Biologische Wissenschaft, eds Mayr E,
Schüz E (Universitätsverlag Winter, Heidelberg), pp 84–88.
2. Simpson GG (1944) Tempo and Mode in Evolution (Columbia Univ Press, New York).
3. Hodges SA (1997) Floral nectar spurs and diversification. Int J Plant Sci 158(Suppl 6):
S81–S88.
4. Lengyel S, Gove AD, Latimer AM, Majer JD, Dunn RR (2009) Ants sow the seeds of
global diversification in flowering plants. PLoS ONE 4(5):e5480.
5. Sargent RD (2004) Floral symmetry affects speciation rates in angiosperms. Proc Biol
Sci 271(1539):603–608.
6. Farrell BD, Dussourd DE, Mitter C (1991) Escalation of plant defense: Do latex and
resin canals spur plant diversification? Am Nat 138(4):881–900.
7. Janzen DH (1966) Coevolution of mutualism between ants and acacias in Central
America. Evolution 20(3):249–275.
8. Boucher DH (1985) The Biology of Mutualism: Ecology and Evolution (Oxford Univ
Press, New York).
9. Heil M, McKey D (2003) Protective ant-plant interactions as model systems in ecological and evolutionary research. Annu Rev Ecol Evol Syst 34:425–453.
10. Marazzi B, Sanderson MJ (2010) Large-scale patterns of diversification in the widespread legume genus Senna and the evolutionary role of extrafloral nectaries. Evolution 64(12):3570–3592.
11. Barraclough TG, Harvey PH, Nee S (1995) Sexual selection and taxonomic diversity in
passerine birds. Proc R Soc Lond B Biol Sci 259(1355):211–215.
12. Bruno JF, Stachowicz JJ, Bertness MD (2003) Inclusion of facilitation into ecological
theory. Trends Ecol Evol 18(3):119–125.
13. de Queiroz A (2002) Contingent predictability in evolution: Key traits and diversification. Syst Biol 51(6):917–929.
14. Donoghue MJ (2005) Key innovations, convergence, and success: Macroevolutionary
lessons from plant phylogeny. Paleobiology 31(2, Suppl):77–93.
15. Wainwright PC, et al. (2012) The evolution of pharyngognathy: A phylogenetic and
functional appraisal of the pharyngeal jaw key innovation in labroid fishes and beyond. Syst Biol 61(6):1001–1027.
16. Koptur S (1992) Extrafloral nectary-mediated interactions between insects and plants.
Insect Plant Interactions (CRC, Boca Raton, FL), Vol IV, pp 81–129.
17. Bentley BL (1977) Extrafloral nectaries and protection by pugnacious bodyguards.
Annu Rev Ecol Syst 8:407–427.
18. Weber MG, Keeler KH (2013) The phylogenetic distribution of extrafloral nectaries in
plants. Ann Bot (Lond) 111(6):1251–1261.
19. Angiosperm Phylogeny Group (2009) An update of the Angiosperm Phylogeny Group
classification for the orders and families of flowering plants: APGIII. Bot J Linn Soc
161(2):105–121.
20. Wikström N, Savolainen V, Chase MW (2001) Evolution of the angiosperms: Calibrating the family tree. Proc Biol Sci 268(1482):2211–2220.
21. Zanne AE, et al. (2014) Three keys to the radiation of angiosperms into freezing
environments. Nature 506(7486):89–92.
22. Marazzi B, Endress PK, Queiroz LP, Conti E (2006) Phylogenetic relationships within
Senna (Leguminosae, Cassiinae) based on three chloroplast DNA regions: Patterns in
the evolution of floral symmetry and extrafloral nectaries. Am J Bot 93(2):288–303.
23. Mercedes Arbo M, Espert SM (2009) Morphology, phylogeny and biogeography of
Turnera L. (Turneraceae). Taxon 58(2):457–467.
24. Otto EM, Janssen T, Kreier H-P, Schneider H (2009) New insights into the phylogeny
of Pleopeltis and related Neotropical genera (Polypodiaceae, Polypodiopsida). Mol
Phylogenet Evol 53(1):190–201.
25. Schuster TM, Reveal JL, Kron KA (2011) Phylogeny of Polygoneae (Polygonaceae:
Polygonoideae). Taxon 60(6):1653–1666.
26. Whitlock BA, Hale AM (2011) The phylogeny of Ayenia, Byttneria, and Rayleya
(Malvaceae s. l.) and its implications for the evolution of growth forms. Syst Botany
36(1):129–136.
27. Weber MG, Clement WL, Donoghue MJ, Agrawal AA (2012) Phylogenetic and experimental tests of interactions among mutualistic plant defense traits in Viburnum
(Adoxaceae). Am Nat 180(4):450–463.
28. Marazzi B, Conti E, Sanderson MJ, McMahon MM, Bronstein JL (2013) Diversity and
evolution of a trait mediating ant-plant interactions: Insights from extrafloral nectaries in Senna (Leguminosae). Ann Bot (Lond) 111(6):1263–1275.
29. Maddison WP, Midford PE, Otto SP (2007) Estimating a binary character’s effect on
speciation and extinction. Syst Biol 56(5):701–710.

30. FitzJohn RG, Maddison WP, Otto SP (2009) Estimating trait-dependent speciation and
extinction rates from incompletely resolved phylogenies. Syst Biol 58(6):595–611.
31. FitzJohn RG (2012) Diversitree: Comparative phylogenetic analyses of diversification
in R. Methods Ecol Evol 3(6):1084–1092.
32. Rabosky DL (2014) Automatic detection of key innovations, rate shifts, and diversitydependence on phylogenetic trees. PLoS ONE 9(2):e89543.
33. Bronstein JL, Alarcón R, Geber M (2006) The evolution of plant-insect mutualisms.
New Phytol 172(3):412–428.
34. Spriggs EL, Christin P-A, Edwards EJ (2014) C4 photosynthesis promoted species diversification during the Miocene grassland expansion. PLoS ONE 9(5):e97722.
35. Bininda-Emonds OR, et al. (2007) The delayed rise of present-day mammals. Nature
446(7135):507–512.
36. Nel A, Roques P, Nel P, Prokop J, Steyer JS (2007) The earliest holometabolous insect
from the Carboniferous: A “crucial” innovation with delayed success (Insecta Protomeropina Protomeropidae). Annales de la Société Entomologique de France 43(3):
349–355.
37. Webb CO, Donoghue MJ (2005) Phylomatic: Tree assembly for applied phylogenetics.
Mol Ecol Notes 5:181–183.
38. Webb CO, Ackerly DD, Kembel SW (2008) Phylocom: Software for the analysis of phylogenetic community structure and trait evolution. Bioinformatics 24(18):2098–2100.
39. Soltis DE, et al. (2011) Angiosperm phylogeny: 17 genes, 640 taxa. Am J Bot 98(4):
704–730.
40. Paradis E, Claude J, Strimmer K (2004) APE: Analyses of Phylogenetics and Evolution in
R language. Bioinformatics 20(2):289–290.
41. Magallón S, Sanderson MJ (2001) Absolute diversification rates in angiosperm clades.
Evolution 55(9):1762–1780, and erratum (2006) 60(11):2411.
42. Harmon LJ, Weir JT, Brock CD, Glor RE, Challenger W (2008) GEIGER: Investigating
evolutionary radiations. Bioinformatics 24(1):129–131.
43. Stevens P (2001) Angiosperm Phylogeny Website, Version 12, July 2012 (Missouri Botanical Garden, University of Missouri, St. Louis, MO). Available at www.mobot.org/
MOBOT/research/APweb/. Accessed September 3, 2014.
44. Fritz SA, Purvis A (2010) Selectivity in mammalian extinction risk and threat types: A new
measure of phylogenetic signal strength in binary traits. Conserv Biol 24(4):1042–1051.
45. Orme CDL, Freckleton RP, Thomas GH, Petzold T, Fritz SA (2013) caper: Comparative
analyses of phylogenetics and evolution in R. R package version 0.5.2. Available at
R-Forge.R-project.org/projects/caper/. Accessed December 4, 2013.
46. Sanderson MJ, Boss D, Chen D, Cranston KA, Wehe A (2008) The PhyLoTA Browser:
Processing GenBank for molecular phylogenetics research. Syst Biol 57(3):335–346.
47. Katoh K, Toh H (2008) Recent developments in the MAFFT multiple sequence alignment program. Brief Bioinform 9(4):286–298.
48. R Development Core Team (2012) R: A Language and Environment for Statistical
Computing (R Foundation for Statistical Computing, Vienna).
49. Heibl C (2008) PHYLOCH: R language tree plotting tools and interfaces to diverse
phylogenetic software packages. Available at www.christophheibl.de/Rpackages.
html. Accessed November 1, 2013.
50. Posada D (2008) jModelTest: Phylogenetic model averaging. Mol Biol Evol 25(7):
1253–1256.
51. Schliep KP (2011) phangorn: Phylogenetic analysis in R. Bioinformatics 27(4):592–593.
52. Drummond AJ, Suchard MA, Xie D, Rambaut A (2012) Bayesian phylogenetics with
BEAUti and the BEAST 1.7. Mol Biol Evol 29(8):1969–1973.
53. Rambaut A, Drummond AJ (2007) Tracer v1.5. Available at beast.bio.ed.ac.uk/Tracer.
Accessed December 1, 2009.
54. Rambaut A, Drummond A (2012) LogCombiner v1. 7.5 MCMC Output Combiner.
Available at beast.bio.ed.ac.uk. Accessed April 15, 2013.
55. Rambaut A, Drummond A (2012) TreeAnnotator, version 1.7.5. Available at beast.bio.
ed.ac.uk/TreeAnnotator. Accessed April 15, 2013.
56. Keeler KH (2014) World list of plants with extrafloral nectaries. Available at www.
extrafloralnectaries.org. Accessed October 14, 2014.
57. Clement WL, Donoghue MJ (2012) Barcoding success as a function of phylogenetic
relatedness in Viburnum, a clade of woody angiosperms. BMC Evol Biol 12(1):73.
58. Whitlock MC (2005) Combining probability from independent tests: The weighted
Z-method is superior to Fisher’s approach. J Evol Biol 18(5):1368–1373.
59. Rabosky DL, et al. (2014) BAMMtools: An R package for the analysis of evolutionary
dynamics on phylogenetic trees. Methods Ecol Evol 5(7):701–707.
60. Plummer M, Best N, Cowles K, Vines K (2006) CODA: Convergence diagnosis and
output analysis for MCMC. R News 6(1):7–11.

Weber and Agrawal

PNAS | November 18, 2014 | vol. 111 | no. 46 | 16447

EVOLUTION

ACKNOWLEDGMENTS. We thank María Mercedes Arbo, Ana Maria Gonzalez,
Elizabeth Otto, Harald Schneider, Matthew Jebb, and Tanja Schuster for help
with EFN distributions within clades. We thank Gideon Bradburd, Michael
Donoghue, Monica Geber, Harry Greene, Marc Johnson, Irby Lovette, Luke
Mahler, Brigitte Marazzi, Nicholas Mason, Sally Otto, Dan Rabosky, Michael
Sanderson, Catherine Wagner, and three anonymous reviewers for providing
discussion or comments that improved this project. A.A.A. was supported by
Grant 1118783 of the Division of Environmental Biology of the National Science Foundation (NSF) and by the John Templeton Foundation. M.G.W. was
supported by the Society for the Study of Evolution’s Rosemary Grant Award
and by the NSF (Graduate Research Fellowship and Doctoral Dissertation Improvement Grant).

